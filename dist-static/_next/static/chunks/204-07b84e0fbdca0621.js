"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[204],{2204:(t,e,a)=>{a.d(e,{C:()=>S});var o=a(8693),r=a(2354);let c="https://ohanjvrxywgreokkeckd.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9oYW5qdnJ4eXdncmVva2tlY2tkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NjcwODMsImV4cCI6MjA3MzU0MzA4M30.XdELUZoogrJnjj3Va_kVwKEBM7GdS30EKGUZHbO3Wvo";console.log("\uD83D\uDD27 Supabase Config:",{url:c,hasKey:!!l});let i=async()=>{try{console.log("\uD83D\uDD0D Testando conex\xe3o com Supabase...");let{data:t,error:e}=await n.from("board_activities").select("count",{count:"exact"});if(e)return console.error("❌ Erro na conex\xe3o:",{message:e.message,details:e.details,hint:e.hint,code:e.code,status:e.status||"N/A"}),!1;return console.log("✅ Conex\xe3o OK - board_activities:",t),!0}catch(t){return console.error("❌ Erro de conex\xe3o geral:",t),!1}},n=(0,r.UU)(c,l),s={async getAll(){let{data:t,error:e}=await n.from("board_activities").select("*").order("created_at",{ascending:!1});if(e)throw console.error("❌ Erro detalhado boardActivities:",{message:e.message,details:e.details,hint:e.hint,code:e.code}),e;return t||[]},async create(t){let{data:e,error:a}=await n.from("board_activities").insert([{...t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(a)throw a;return e},async update(t,e){let{data:a,error:o}=await n.from("board_activities").update({...e,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(o)throw o;return a},async delete(t){let{error:e}=await n.from("board_activities").delete().eq("id",t);if(e)throw e}},d={async getAll(){let{data:t,error:e}=await n.from("collaborators").select("*").order("name",{ascending:!0});if(e)throw console.error("❌ Erro detalhado collaborators:",e),e;return t||[]},async create(t){let{data:e,error:a}=await n.from("collaborators").insert([{...t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(a)throw a;return e},async update(t,e){let{data:a,error:o}=await n.from("collaborators").update({...e,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(o)throw o;return a},async delete(t){let{error:e}=await n.from("collaborators").delete().eq("id",t);if(e)throw e}},p={async getAll(){let{data:t,error:e}=await n.from("okrs").select("*").order("created_at",{ascending:!1});if(e)throw console.error("❌ Erro detalhado okrs:",e),e;return t||[]},async create(t){let{data:e,error:a}=await n.from("okrs").insert([{...t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(a)throw a;return e},async update(t,e){let{data:a,error:o}=await n.from("okrs").update({...e,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(o)throw o;return a},async delete(t){let{error:e}=await n.from("okrs").delete().eq("id",t);if(e)throw e}},u={async getAll(){let{data:t,error:e}=await n.from("rituals").select("*").order("created_at",{ascending:!1});if(e)throw console.error("❌ Erro detalhado rituals:",e),e;return t||[]},async create(t){let{data:e,error:a}=await n.from("rituals").insert([{...t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(a)throw a;return e},async update(t,e){let{data:a,error:o}=await n.from("rituals").update({...e,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(o)throw o;return a},async delete(t){let{error:e}=await n.from("rituals").delete().eq("id",t);if(e)throw e}},g={async getAll(){try{let{data:e,error:a}=await n.from("projects").select("*").order("created_at",{ascending:!1});if(a){var t;if(console.error("❌ Erro detalhado projects:",a),"PGRST116"===a.code||(null==(t=a.message)?void 0:t.includes("does not exist")))return console.warn("⚠️ Tabela projects n\xe3o encontrada, usando fallback"),[];throw a}return e||[]}catch(t){return console.error("❌ Erro ao acessar projects:",t),[]}},async create(t){try{let{data:e,error:a}=await n.from("projects").insert([{...t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(a){console.warn("⚠️ Erro ao criar project no Supabase, salvando no localStorage");let e={...t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},a=JSON.parse(localStorage.getItem("caaqui_projects")||"[]");return a.push(e),localStorage.setItem("caaqui_projects",JSON.stringify(a)),e}return e}catch(t){throw console.error("❌ Erro ao criar project:",t),t}},async update(t,e){let{data:a,error:o}=await n.from("projects").update({...e,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(o)throw o;return a},async delete(t){let{error:e}=await n.from("projects").delete().eq("id",t);if(e)throw e}},h={async getAll(){try{let{data:e,error:a}=await n.from("project_allocations").select("\n          *,\n          projects(name, client),\n          collaborators(name, role)\n        ").order("created_at",{ascending:!1});if(a){var t;if(console.error("❌ Erro detalhado project_allocations:",a),"PGRST116"===a.code||(null==(t=a.message)?void 0:t.includes("does not exist")))return console.warn("⚠️ Tabela project_allocations n\xe3o encontrada, usando fallback"),[];throw a}return e||[]}catch(t){return console.error("❌ Erro ao acessar project_allocations:",t),[]}},async getByProject(t){let{data:e,error:a}=await n.from("project_allocations").select("\n        *,\n        collaborators(name, role, email)\n      ").eq("project_id",t);if(a)throw a;return e||[]},async getByCollaborator(t){let{data:e,error:a}=await n.from("project_allocations").select("\n        *,\n        projects(name, client, end_date)\n      ").eq("collaborator_id",t);if(a)throw a;return e||[]},async create(t){let{data:e,error:a}=await n.from("project_allocations").insert([{...t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(a)throw a;return e},async update(t,e){let{data:a,error:o}=await n.from("project_allocations").update({...e,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(o)throw o;return a},async delete(t){let{error:e}=await n.from("project_allocations").delete().eq("id",t);if(e)throw e}};var j=a(5434);let w={boardActivity:t=>({id:t.id,title:t.title,status:t.status,assigneeId:t.assignee_id,description:t.description,client:t.client,points:t.points,createdAt:t.created_at?new Date(t.created_at):void 0,subtasks:t.subtasks}),collaborator:t=>({id:t.id,name:t.name,email:t.email,role:t.role,avatar:t.avatar,accessLevel:"operations",position:t.role||"Membro"}),okr:t=>({id:t.id,title:t.title,description:t.description,progress:t.progress,quarter:"Q1 2024",activities:t.activities||[]}),ritual:t=>({id:t.id,title:t.title,content:t.content,frequency:t.frequency,nextDate:t.next_date?new Date(t.next_date):void 0}),project:t=>({id:t.id,name:t.name,client:t.client,type:"tech_implementation"===t.type?"tech":"growth",status:t.status,startDate:new Date(t.start_date),endDate:new Date(t.end_date),description:t.description,budget:t.budget,allocations:[],archivedAt:t.archived_at?new Date(t.archived_at):void 0,techDetails:t.tech_details,growthDetails:t.growth_details}),projectAllocation:t=>({id:t.id,projectId:t.project_id,collaboratorId:t.collaborator_id,percentage:t.percentage,role:t.role,startDate:new Date(t.start_date),endDate:new Date(t.end_date)})},m={boardActivity:t=>({id:t.id,title:t.title,status:t.status,assignee_id:t.assigneeId,description:t.description,client:t.client,points:t.points,subtasks:t.subtasks}),collaborator:t=>({id:t.id,name:t.name,email:t.email,role:t.role,avatar:t.avatar}),okr:t=>({id:t.id,title:t.title,description:t.description,progress:t.progress,activities:t.activities}),ritual:t=>{var e;return{id:t.id,title:t.title,content:t.content,frequency:t.frequency,next_date:null==(e=t.nextDate)?void 0:e.toISOString()}},project:t=>{var e,a;return{name:t.name,client:t.client,type:"tech"===t.type?"tech_implementation":"growth_agency",status:"archived"===t.status?"cancelled":t.status,start_date:null==(e=t.startDate)?void 0:e.toISOString(),end_date:null==(a=t.endDate)?void 0:a.toISOString(),description:t.description,budget:t.budget,tech_details:t.techDetails,growth_details:t.growthDetails}},projectAllocation:t=>{var e,a;return{id:t.id,project_id:t.projectId,collaborator_id:t.collaboratorId,percentage:t.percentage,role:t.role,start_date:null==(e=t.startDate)?void 0:e.toISOString(),end_date:null==(a=t.endDate)?void 0:a.toISOString()}}},y=()=>Math.random().toString(36).slice(2)+Date.now().toString(36),S=(0,o.vt)()((t,e)=>({boardActivities:[],collaborators:[],okrs:[],rituals:[],projects:[],projectAllocations:[],isLoading:!1,error:null,setLoading:e=>t({isLoading:e}),setError:e=>t({error:e}),loadAllData:async()=>{try{var e,o,r;t({isLoading:!0,error:null});{let{initializeFallbackData:t}=await a.e(976).then(a.bind(a,3976));t()}if(!await i())throw Error("Falha na conex\xe3o com Supabase");let[c,l,n,m,y,S]=await Promise.all([s.getAll().catch(t=>(console.error("Erro ao carregar boardActivities:",t),[])),d.getAll().catch(t=>(console.error("Erro ao carregar collaborators:",t),[])),p.getAll().catch(t=>(console.error("Erro ao carregar okrs:",t),[])),u.getAll().catch(t=>(console.error("Erro ao carregar rituals:",t),[])),g.getAll().catch(t=>(console.error("Erro ao carregar projects:",t),[])),h.getAll().catch(t=>(console.error("Erro ao carregar project_allocations:",t),[]))]),b=y,f=S,v=c;if(0===y.length)try{let t=localStorage.getItem("caaqui_projects");if(t)b=JSON.parse(t),console.log("\uD83D\uDCE6 Carregando projects do localStorage:",b.length);else{console.log("\uD83D\uDD04 Inicializando dados de fallback para projects...");let{initializeFallbackData:t}=await a.e(976).then(a.bind(a,3976));t();let e=localStorage.getItem("caaqui_projects");e&&(b=JSON.parse(e),console.log("✅ Dados de fallback criados para projects:",b.length))}}catch(t){console.warn("Erro ao carregar projects do localStorage:",t)}if(0===S.length)try{let t=localStorage.getItem("caaqui_project_allocations");if(t)f=JSON.parse(t),console.log("\uD83D\uDCE6 Carregando project_allocations do localStorage:",f.length);else{console.log("\uD83D\uDD04 Inicializando dados de fallback para project_allocations...");let{initializeFallbackData:t}=await a.e(976).then(a.bind(a,3976));t();let e=localStorage.getItem("caaqui_project_allocations");e&&(f=JSON.parse(e),console.log("✅ Dados de fallback criados para project_allocations:",f.length))}}catch(t){console.warn("Erro ao carregar project_allocations do localStorage:",t)}if(0===c.length)try{(v=(0,j.cY)(j.d5.BOARD_ACTIVITIES)).length>0&&console.log("\uD83D\uDCE6 Carregando board_activities do localStorage:",v.length)}catch(t){console.warn("Erro ao carregar board_activities do localStorage:",t)}t({boardActivities:v.length>0?(null==(e=v[0])?void 0:e.id)?v.map(w.boardActivity):v:[],collaborators:l.map(w.collaborator),okrs:n.map(w.okr),rituals:m.map(w.ritual),projects:b.length>0?(null==(o=b[0])?void 0:o.id)?b.map(w.project):b:[],projectAllocations:f.length>0?(null==(r=f[0])?void 0:r.id)?f.map(w.projectAllocation):f:[],isLoading:!1})}catch(e){console.error("Erro geral ao carregar dados:",e),t({error:"Erro ao conectar com Supabase: ".concat(e.message),isLoading:!1})}},addBoardActivity:async(e,a)=>{try{var o;let r={id:y(),title:e,status:null!=(o=null==a?void 0:a.status)?o:"todo",assignee_id:null==a?void 0:a.assigneeId,description:null==a?void 0:a.description,client:null==a?void 0:a.client,project_id:null==a?void 0:a.projectId,points:null==a?void 0:a.points,subtasks:null==a?void 0:a.subtasks,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};try{let e=await s.create(r),a=w.boardActivity(e);t(t=>({boardActivities:[...t.boardActivities,a]}))}catch(o){console.warn("⚠️ Erro ao criar atividade no Supabase, usando localStorage");let e=(0,j.cY)(j.d5.BOARD_ACTIVITIES);e.push(r),(0,j.gC)(j.d5.BOARD_ACTIVITIES,e);let a=w.boardActivity(r);t(t=>({boardActivities:[...t.boardActivities,a]}))}}catch(e){console.error("Erro ao adicionar atividade:",e),t({error:"Erro ao adicionar atividade"})}},updateBoardActivity:async(e,a)=>{try{try{let o=m.boardActivity(a),r=await s.update(e,o),c=w.boardActivity(r);t(t=>({boardActivities:t.boardActivities.map(t=>t.id===e?{...t,...c}:t)}))}catch(c){console.warn("⚠️ Erro ao atualizar atividade no Supabase, usando localStorage");let o={...a,id:e,updatedAt:new Date};t(t=>({boardActivities:t.boardActivities.map(t=>t.id===e?{...t,...o}:t)}));let r=(0,j.cY)(j.d5.BOARD_ACTIVITIES).map(t=>t.id===e?{...t,...m.boardActivity(o)}:t);(0,j.gC)(j.d5.BOARD_ACTIVITIES,r)}}catch(e){console.error("Erro ao atualizar atividade:",e),t({error:"Erro ao atualizar atividade"})}},deleteBoardActivity:async e=>{try{try{await s.delete(e)}catch(a){console.warn("⚠️ Erro ao deletar atividade no Supabase, usando localStorage");let t=(0,j.cY)(j.d5.BOARD_ACTIVITIES).filter(t=>t.id!==e);(0,j.gC)(j.d5.BOARD_ACTIVITIES,t)}t(t=>({boardActivities:t.boardActivities.filter(t=>t.id!==e)}))}catch(e){console.error("Erro ao deletar atividade:",e),t({error:"Erro ao deletar atividade"})}},addCollaborator:async e=>{try{let a={id:y(),...e},o=await d.create(a),r=w.collaborator(o);t(t=>({collaborators:[...t.collaborators,r]}))}catch(e){console.error("Erro ao adicionar colaborador:",e),t({error:"Erro ao adicionar colaborador"})}},updateCollaborator:async(e,a)=>{try{let o=m.collaborator(a),r=await d.update(e,o),c=w.collaborator(r);t(t=>({collaborators:t.collaborators.map(t=>t.id===e?{...t,...c}:t)}))}catch(e){console.error("Erro ao atualizar colaborador:",e),t({error:"Erro ao atualizar colaborador"})}},deleteCollaborator:async e=>{try{await d.delete(e),t(t=>({collaborators:t.collaborators.filter(t=>t.id!==e)}))}catch(e){console.error("Erro ao deletar colaborador:",e),t({error:"Erro ao deletar colaborador"})}},addOKR:async e=>{try{let a={id:y(),...e},o=await p.create(a),r=w.okr(o);t(t=>({okrs:[...t.okrs,r]}))}catch(e){console.error("Erro ao adicionar OKR:",e),t({error:"Erro ao adicionar OKR"})}},updateOKR:async(e,a)=>{try{let o=m.okr(a),r=await p.update(e,o),c=w.okr(r);t(t=>({okrs:t.okrs.map(t=>t.id===e?{...t,...c}:t)}))}catch(e){console.error("Erro ao atualizar OKR:",e),t({error:"Erro ao atualizar OKR"})}},deleteOKR:async e=>{try{await p.delete(e),t(t=>({okrs:t.okrs.filter(t=>t.id!==e)}))}catch(e){console.error("Erro ao deletar OKR:",e),t({error:"Erro ao deletar OKR"})}},addOKRActivity:async(a,o,r)=>{try{let t=e().okrs.find(t=>t.id===a);if(!t)return;let c={id:y(),title:o,assigneeId:r},l=[...t.activities,c];await e().updateOKR(a,{activities:l})}catch(e){console.error("Erro ao adicionar atividade OKR:",e),t({error:"Erro ao adicionar atividade OKR"})}},updateOKRActivity:async(a,o,r)=>{try{let t=e().okrs.find(t=>t.id===a);if(!t)return;let c=t.activities.map(t=>t.id===o?{...t,...r}:t);await e().updateOKR(a,{activities:c})}catch(e){console.error("Erro ao atualizar atividade OKR:",e),t({error:"Erro ao atualizar atividade OKR"})}},deleteOKRActivity:async(a,o)=>{try{let t=e().okrs.find(t=>t.id===a);if(!t)return;let r=t.activities.filter(t=>t.id!==o);await e().updateOKR(a,{activities:r})}catch(e){console.error("Erro ao deletar atividade OKR:",e),t({error:"Erro ao deletar atividade OKR"})}},addRitual:async e=>{try{let a={id:y(),title:e},o=await u.create(a),r=w.ritual(o);t(t=>({rituals:[...t.rituals,r]}))}catch(e){console.error("Erro ao adicionar ritual:",e),t({error:"Erro ao adicionar ritual"})}},updateRitual:async(e,a)=>{try{let o=m.ritual(a),r=await u.update(e,o),c=w.ritual(r);t(t=>({rituals:t.rituals.map(t=>t.id===e?{...t,...c}:t)}))}catch(e){console.error("Erro ao atualizar ritual:",e),t({error:"Erro ao atualizar ritual"})}},deleteRitual:async e=>{try{await u.delete(e),t(t=>({rituals:t.rituals.filter(t=>t.id!==e)}))}catch(e){console.error("Erro ao deletar ritual:",e),t({error:"Erro ao deletar ritual"})}},addProject:async e=>{try{let a={id:y(),...e,createdAt:new Date,updatedAt:new Date};try{let e=m.project(a),o=await g.create(e),r=w.project(o);t(t=>({projects:[...t.projects,r]}))}catch(c){console.warn("⚠️ Erro ao criar projeto no Supabase, usando localStorage");let e=JSON.parse(localStorage.getItem("caaqui_projects")||"[]"),o=m.project(a);e.push(o),localStorage.setItem("caaqui_projects",JSON.stringify(e));let r={...a,allocations:[]};t(t=>({projects:[...t.projects,r]}))}}catch(e){console.error("Erro ao adicionar projeto:",e),t({error:"Erro ao adicionar projeto"})}},updateProject:async(e,a)=>{try{try{let o=m.project(a),r=await g.update(e,o),c=w.project(r);t(t=>({projects:t.projects.map(t=>t.id===e?{...t,...c}:t)}))}catch(c){console.warn("⚠️ Erro ao atualizar no Supabase, usando localStorage");let o={...a,id:e,updatedAt:new Date};t(t=>({projects:t.projects.map(t=>t.id===e?{...t,...o}:t)}));let r=JSON.parse(localStorage.getItem("caaqui_projects")||"[]").map(t=>t.id===e?{...t,...m.project(o)}:t);localStorage.setItem("caaqui_projects",JSON.stringify(r))}}catch(e){console.error("Erro ao atualizar projeto:",e),t({error:"Erro ao atualizar projeto"})}},deleteProject:async e=>{try{try{await g.delete(e)}catch(a){console.warn("⚠️ Erro ao deletar no Supabase, usando localStorage");let t=JSON.parse(localStorage.getItem("caaqui_projects")||"[]").filter(t=>t.id!==e);localStorage.setItem("caaqui_projects",JSON.stringify(t))}t(t=>({projects:t.projects.filter(t=>t.id!==e)}))}catch(e){console.error("Erro ao deletar projeto:",e),t({error:"Erro ao deletar projeto"})}},addProjectAllocation:async e=>{try{let a={id:y(),...e};try{let e=m.projectAllocation(a),o=await h.create(e),r=w.projectAllocation(o);t(t=>({projectAllocations:[...t.projectAllocations,r]}))}catch(r){console.warn("⚠️ Erro ao criar aloca\xe7\xe3o no Supabase, usando localStorage");let e=JSON.parse(localStorage.getItem("caaqui_project_allocations")||"[]"),o=m.projectAllocation(a);e.push(o),localStorage.setItem("caaqui_project_allocations",JSON.stringify(e)),t(t=>({projectAllocations:[...t.projectAllocations,a]}))}}catch(e){console.error("Erro ao adicionar aloca\xe7\xe3o:",e),t({error:"Erro ao adicionar aloca\xe7\xe3o"})}},updateProjectAllocation:async(e,a)=>{try{try{let o=m.projectAllocation(a),r=await h.update(e,o),c=w.projectAllocation(r);t(t=>({projectAllocations:t.projectAllocations.map(t=>t.id===e?{...t,...c}:t)}))}catch(c){console.warn("⚠️ Erro ao atualizar aloca\xe7\xe3o no Supabase, usando localStorage");let o={...a,id:e,updatedAt:new Date};t(t=>({projectAllocations:t.projectAllocations.map(t=>t.id===e?{...t,...o}:t)}));let r=JSON.parse(localStorage.getItem("caaqui_project_allocations")||"[]").map(t=>t.id===e?{...t,...m.projectAllocation(o)}:t);localStorage.setItem("caaqui_project_allocations",JSON.stringify(r))}}catch(e){console.error("Erro ao atualizar aloca\xe7\xe3o:",e),t({error:"Erro ao atualizar aloca\xe7\xe3o"})}},deleteProjectAllocation:async e=>{try{try{await h.delete(e)}catch(a){console.warn("⚠️ Erro ao deletar aloca\xe7\xe3o no Supabase, usando localStorage");let t=JSON.parse(localStorage.getItem("caaqui_project_allocations")||"[]").filter(t=>t.id!==e);localStorage.setItem("caaqui_project_allocations",JSON.stringify(t))}t(t=>({projectAllocations:t.projectAllocations.filter(t=>t.id!==e)}))}catch(e){console.error("Erro ao deletar aloca\xe7\xe3o:",e),t({error:"Erro ao deletar aloca\xe7\xe3o"})}},getTeamAvailability:()=>{let t=e(),a=[];return console.log("\uD83D\uDD0D Debug disponibilidade detalhado:"),console.log("- Total collaborators:",t.collaborators.length),console.log("- Total projectAllocations:",t.projectAllocations.length),console.log("- Total projects:",t.projects.length),t.collaborators.forEach(e=>{console.log("\n\uD83D\uDC64 Analisando ".concat(e.name," (").concat(e.id,"):"));let o=new Date,r=t.projectAllocations.filter(t=>t.collaboratorId===e.id);console.log("- Total aloca\xe7\xf5es para ".concat(e.name,":"),r.length),r.forEach(e=>{let a=t.projects.find(t=>t.id===e.projectId),r=new Date(e.endDate)>o;console.log("  • Projeto: ".concat((null==a?void 0:a.name)||"N\xc3O ENCONTRADO"," (").concat(e.projectId,")")),console.log("    - Percentual: ".concat(e.percentage,"%")),console.log("    - Ativo: ".concat(r)),console.log("    - Data fim: ".concat(e.endDate))});let c=r.filter(t=>new Date(t.endDate)>o),l=c.reduce((t,e)=>t+e.percentage,0),i=e.maxAllocation||100,n=c.map(e=>{let a=t.projects.find(t=>t.id===e.projectId);return{projectId:e.projectId,projectName:(null==a?void 0:a.name)||"Projeto n\xe3o encontrado",allocation:e.percentage,endDate:e.endDate}});a.push({collaboratorId:e.id,name:e.name,role:e.role,totalAllocation:Math.min(l,i),availableAllocation:Math.max(0,i-l),projects:n})}),a},getProjectMetrics:()=>{let{projects:t,projectAllocations:a,collaborators:o}=e();return t.map(t=>{let e=a.filter(e=>e.projectId===t.id),r=e.reduce((t,e)=>e.percentage,0),c=e.reduce((t,e)=>{let a=o.find(t=>t.id===e.collaboratorId);if(!(null==a?void 0:a.hourlyRate))return t;let r=new Date(e.startDate),c=Math.ceil((new Date(e.endDate).getTime()-r.getTime())/6048e5);return t+e.percentage/100*40*c*a.hourlyRate},0),l=new Date(t.startDate),i=new Date(t.endDate),n=new Date,s=Math.ceil((i.getTime()-l.getTime())/864e5),d=Math.ceil((n.getTime()-l.getTime())/864e5),p=Math.ceil((i.getTime()-n.getTime())/864e5),u=Math.min(100,Math.max(0,d/s*100));return{id:t.id,name:t.name,status:t.status,progressPct:u,daysRemaining:p,isOnTime:p>=0&&u<=100,totalAllocation:r,realCost:c,budgetVariance:t.budget?(c-t.budget)/t.budget*100:0}})},archiveProject:async a=>{try{let t=new Date;await e().updateProject(a,{status:"archived",archivedAt:t})}catch(e){console.error("Erro ao arquivar projeto:",e),t({error:"Erro ao arquivar projeto"})}},restoreProject:async a=>{try{await e().updateProject(a,{status:"active",archivedAt:void 0})}catch(e){console.error("Erro ao restaurar projeto:",e),t({error:"Erro ao restaurar projeto"})}},permanentlyDeleteProject:async a=>{try{await e().deleteProject(a)}catch(e){console.error("Erro ao excluir projeto permanentemente:",e),t({error:"Erro ao excluir projeto permanentemente"})}},cleanupArchivedProjects:async()=>{try{let{projects:t}=e(),a=new Date;a.setDate(a.getDate()-30);let o=t.filter(t=>"archived"===t.status&&t.archivedAt&&t.archivedAt<a);for(let t of o)await e().permanentlyDeleteProject(t.id);console.log("Limpeza autom\xe1tica: ".concat(o.length," projetos removidos"))}catch(t){console.error("Erro na limpeza de projetos arquivados:",t)}},duplicateProject:async(a,o)=>{try{let{projects:t,projectAllocations:r}=e(),c=t.find(t=>t.id===a);if(!c)throw Error("Projeto n\xe3o encontrado");let l={name:o||"".concat(c.name," (C\xf3pia)"),client:c.client,type:c.type,status:"planning",startDate:new Date,endDate:new Date(Date.now()+2592e6),description:c.description,budget:c.budget,techDetails:c.techDetails,growthDetails:c.growthDetails};await e().addProject(l);let{projects:i}=e(),n=i.find(t=>t.name===l.name);if(n)for(let t of r.filter(t=>t.projectId===a)){let a={projectId:n.id,collaboratorId:t.collaboratorId,percentage:t.percentage,role:t.role,startDate:l.startDate,endDate:l.endDate};await e().addProjectAllocation(a)}console.log("Projeto duplicado com sucesso")}catch(e){console.error("Erro ao duplicar projeto:",e),t({error:"Erro ao duplicar projeto"})}},createProjectFromTemplate:async(o,r,c)=>{try{let{getTemplateById:t,createProjectFromTemplate:l}=await a.e(597).then(a.bind(a,8597)),i=t(o);if(!i)throw Error("Template n\xe3o encontrado");let{project:n,tasks:s}=l(i,r,c);await e().addProject(n);let{projects:d}=e(),p=d.find(t=>t.name===r);if(p)for(let t of s)await e().addBoardActivity(t.title,{...t,projectId:p.id});console.log("Projeto criado a partir do template com sucesso")}catch(e){console.error("Erro ao criar projeto a partir do template:",e),t({error:"Erro ao criar projeto a partir do template"})}},duplicateBoardActivity:async a=>{try{let{boardActivities:t}=e(),o=t.find(t=>t.id===a);if(!o)throw Error("Atividade n\xe3o encontrada");let r={title:"".concat(o.title," (C\xf3pia)"),status:"backlog",assigneeId:o.assigneeId,description:o.description,client:o.client,projectId:o.projectId,subtasks:o.subtasks?[...o.subtasks]:void 0};await e().addBoardActivity(r.title,r),console.log("Card duplicado com sucesso")}catch(e){console.error("Erro ao duplicar card:",e),t({error:"Erro ao duplicar card"})}}}))},5434:(t,e,a)=>{a.d(e,{Qx:()=>i,Rz:()=>l,cY:()=>c,d5:()=>o,gC:()=>r});let o={BOARD_ACTIVITIES:"caaqui_board_activities",PROJECTS:"caaqui_projects",PROJECT_ALLOCATIONS:"caaqui_project_allocations",COLLABORATORS:"caaqui_collaborators",OKRS:"caaqui_okrs",RITUALS:"caaqui_rituals",LAST_SYNC:"caaqui_last_sync"};function r(t,e,a){try{let r={timestamp:new Date().toISOString(),data:e,userId:a};localStorage.setItem(t,JSON.stringify(r)),localStorage.setItem(o.LAST_SYNC,new Date().toISOString());let c=Array.isArray(e)?e.length:"object"==typeof e&&null!==e?Object.keys(e).length:1;console.log("\uD83D\uDCBE Dados salvos em ".concat(t,":"),c,"itens")}catch(t){console.error("Erro ao salvar no localStorage:",t)}}function c(t){try{let e=localStorage.getItem(t);if(!e)return[];let a=JSON.parse(e),o=Array.isArray(a.data)?a.data:[];return console.log("\uD83D\uDCE6 Dados carregados de ".concat(t,":"),o.length,"itens"),o}catch(t){return console.error("Erro ao carregar do localStorage:",t),[]}}function l(){try{let t={};Object.values(o).forEach(e=>{let a=c(e);a.length>0&&(t[e]=a)});let e={timestamp:new Date().toISOString(),version:"1.0",data:t},a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=URL.createObjectURL(a),l=document.createElement("a");return l.href=r,l.download="caaqui-backup-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(r),console.log("\uD83D\uDCE4 Dados exportados com sucesso"),t}catch(t){return console.error("Erro ao exportar dados:",t),{}}}function i(t){try{return Object.entries(t).forEach(t=>{let[e,a]=t;r(e,a)}),console.log("\uD83D\uDCE5 Dados importados com sucesso"),!0}catch(t){return console.error("Erro ao importar dados:",t),!1}}}}]);