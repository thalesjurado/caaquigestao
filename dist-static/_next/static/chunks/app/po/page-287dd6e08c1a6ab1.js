(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[30],{2393:(e,s,t)=>{Promise.resolve().then(t.bind(t,5775))},5749:(e,s,t)=>{"use strict";t.d(s,{Yf:()=>c,oR:()=>m,uU:()=>n});var a=t(2115);let l=new Set,i=[];function r(){l.forEach(e=>e())}function o(e){return l.add(e),()=>l.delete(e)}function d(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,a={id:Math.random().toString(36).slice(2)+Date.now().toString(36),message:e,type:s,duration:t};i=[...i,a],r(),t>0&&setTimeout(()=>{n(a.id)},t)}function n(e){i=i.filter(s=>s.id!==e),r()}function c(){return(0,a.useSyncExternalStore)(o,()=>i,()=>i)}let m={success:e=>d(e,"success"),error:e=>d(e,"error"),info:e=>d(e,"info")}},5775:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>d});var a=t(5155),l=t(2115),i=t(2204),r=t(5749);function o(e){let{projectId:s,onClose:t}=e,{collaborators:o,projectAllocations:d,projects:n,addProjectAllocation:c,updateProjectAllocation:m,deleteProjectAllocation:x}=(0,i.C)(),[u,h]=(0,l.useState)(""),[j,g]=(0,l.useState)(50),[v,p]=(0,l.useState)(""),[b,f]=(0,l.useState)(""),[N,y]=(0,l.useState)(""),[D,w]=(0,l.useState)(null),S=n.find(e=>e.id===s),C=d.filter(e=>e.projectId===s);(0,l.useEffect)(()=>{!S||b||N||(f(S.startDate.toISOString().split("T")[0]),y(S.endDate.toISOString().split("T")[0]))},[S,b,N]),(0,l.useEffect)(()=>{if(u){let e=o.find(e=>e.id===u);e&&!v&&p(e.position||e.role)}},[u,o,v]);let R=async e=>{if(e.preventDefault(),!u||!v||!b||!N)return void r.oR.error("Preencha todos os campos obrigat\xf3rios");let t={projectId:s,collaboratorId:u,percentage:j,role:v,startDate:new Date(b),endDate:new Date(N)};try{D?(await m(D,t),r.oR.success("Aloca\xe7\xe3o atualizada com sucesso")):(await c(t),r.oR.success("Aloca\xe7\xe3o adicionada com sucesso")),h(""),g(50),p(""),w(null)}catch(e){r.oR.error("Erro ao salvar aloca\xe7\xe3o")}},A=async e=>{if(confirm("Tem certeza que deseja remover esta aloca\xe7\xe3o?"))try{await x(e),r.oR.success("Aloca\xe7\xe3o removida com sucesso")}catch(e){r.oR.error("Erro ao remover aloca\xe7\xe3o")}},k=(e,s,t,a)=>{let l=o.find(s=>s.id===e);return(null==l?void 0:l.hourlyRate)?s/100*40*Math.ceil((a.getTime()-t.getTime())/6048e5)*l.hourlyRate:0},I=o.find(e=>e.id===u),E=I&&b&&N?k(u,j,new Date(b),new Date(N)):0,L=(null==I?void 0:I.accessLevel)==="management"||(null==I?void 0:I.accessLevel)==="executive";return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold",children:["Aloca\xe7\xe3o de Equipe - ",null==S?void 0:S.name]}),(0,a.jsx)("button",{onClick:t,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium mb-4",children:D?"Editar Aloca\xe7\xe3o":"Nova Aloca\xe7\xe3o"}),(0,a.jsxs)("form",{onSubmit:R,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Colaborador *"}),(0,a.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"w-full border rounded-lg p-2",required:!0,children:[(0,a.jsx)("option",{value:"",children:"Selecione um colaborador"}),o.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," - ",e.position||e.role]},e.id))]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Aloca\xe7\xe3o (%) *"}),(0,a.jsx)("input",{type:"number",min:"1",max:"100",value:j,onChange:e=>g(Number(e.target.value)),className:"w-full border rounded-lg p-2",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Fun\xe7\xe3o no Projeto *"}),(0,a.jsx)("input",{type:"text",value:v,onChange:e=>p(e.target.value),className:"w-full border rounded-lg p-2",placeholder:"Ex: Tech Lead, Designer",required:!0})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Data In\xedcio *"}),(0,a.jsx)("input",{type:"date",value:b,onChange:e=>f(e.target.value),className:"w-full border rounded-lg p-2",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Data Fim *"}),(0,a.jsx)("input",{type:"date",value:N,onChange:e=>y(e.target.value),className:"w-full border rounded-lg p-2",required:!0})]})]}),L&&(null==I?void 0:I.hourlyRate)&&(0,a.jsxs)("div",{className:"bg-blue-50 rounded-lg p-3",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-800 mb-2",children:"Estimativa de Custo"}),(0,a.jsxs)("div",{className:"text-sm text-blue-700 space-y-1",children:[(0,a.jsxs)("div",{children:["Valor/hora: R$ ",I.hourlyRate.toFixed(2)]}),(0,a.jsxs)("div",{children:["Horas/semana: ",(j/100*40).toFixed(1),"h"]}),(0,a.jsxs)("div",{className:"font-medium",children:["Custo estimado: R$ ",E.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{type:"submit",className:"flex-1 bg-blue-500 text-white rounded-lg py-2 hover:bg-blue-600",children:[D?"Atualizar":"Adicionar"," Aloca\xe7\xe3o"]}),D&&(0,a.jsx)("button",{type:"button",onClick:()=>{w(null),h(""),g(50),p("")},className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancelar"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium mb-4",children:"Aloca\xe7\xf5es Atuais"}),(0,a.jsxs)("div",{className:"space-y-3",children:[C.map(e=>{let s=o.find(s=>s.id===e.collaboratorId),t=k(e.collaboratorId,e.percentage,e.startDate,e.endDate);return(0,a.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:null==s?void 0:s.name}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[e.role," • ",e.percentage,"%"]})]}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)("button",{onClick:()=>{w(e.id),h(e.collaboratorId),g(e.percentage),p(e.role),f(e.startDate.toISOString().split("T")[0]),y(e.endDate.toISOString().split("T")[0])},className:"text-blue-600 hover:text-blue-800 text-sm",children:"Editar"}),(0,a.jsx)("button",{onClick:()=>A(e.id),className:"text-red-600 hover:text-red-800 text-sm",children:"Remover"})]})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[e.startDate.toLocaleDateString()," - ",e.endDate.toLocaleDateString()]}),L&&(0,a.jsxs)("div",{className:"text-xs text-green-600 mt-1",children:["Custo: R$ ",t.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]},e.id)}),0===C.length&&(0,a.jsx)("div",{className:"text-sm text-gray-500 text-center py-4",children:"Nenhuma aloca\xe7\xe3o ainda"})]}),C.length>0&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:"Resumo do Projeto"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["Total de pessoas: ",C.length]}),L&&(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Custo total: R$ ",C.reduce((e,s)=>e+k(s.collaboratorId,s.percentage,s.startDate,s.endDate),0).toLocaleString("pt-BR",{minimumFractionDigits:2})]})]})]})]})]})})}function d(){let{projects:e,projectAllocations:s,collaborators:t}=(0,i.C)(e=>({projects:e.projects,projectAllocations:e.projectAllocations,collaborators:e.collaborators})),[r,d]=(0,l.useState)(null),n=(0,l.useMemo)(()=>e.filter(e=>"planning"===e.status),[e]),c=(0,l.useMemo)(()=>{let e={};for(let t of s)e[t.projectId]=(e[t.projectId]||0)+t.percentage;return e},[s]),m=(0,l.useMemo)(()=>{let e=new Date,a={};for(let t of s)t.startDate<=e&&t.endDate>=e&&(a[t.collaboratorId]=(a[t.collaboratorId]||0)+t.percentage);return t.map(e=>({id:e.id,name:e.name,role:e.position||e.role,total:Math.min(a[e.id]||0,100),available:Math.max(0,100-(a[e.id]||0))}))},[s,t]);return(0,a.jsxs)("div",{className:"max-w-6xl mx-auto p-4 space-y-8",children:[(0,a.jsxs)("header",{className:"space-y-1",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Painel do PO — Organiza\xe7\xe3o e Aloca\xe7\xe3o"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Defina equipes e horas semanais por projeto em planejamento."})]}),(0,a.jsxs)("section",{className:"rounded-2xl border bg-white p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h2",{className:"font-medium",children:'Projetos "Em Planejamento"'}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[n.length," projeto(s)"]})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-3",children:[n.map(e=>(0,a.jsxs)("div",{className:"border rounded-xl p-3",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:e.client}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[e.startDate.toLocaleDateString()," → ",e.endDate.toLocaleDateString()]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"Aloca\xe7\xe3o total"}),(0,a.jsxs)("div",{className:"text-sm font-medium",children:[c[e.id]||0,"%"]})]})]}),(0,a.jsx)("div",{className:"mt-3 flex justify-end",children:(0,a.jsx)("button",{className:"px-3 py-2 rounded-xl bg-black text-white",onClick:()=>d(e.id),children:"Definir Aloca\xe7\xe3o"})})]},e.id)),0===n.length&&(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Nenhum projeto em planejamento no momento."})]})]}),(0,a.jsxs)("section",{className:"rounded-2xl border bg-white p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h2",{className:"font-medium",children:"Capacidade Atual da Opera\xe7\xe3o"}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[m.length," pessoas"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[m.map(e=>(0,a.jsxs)("div",{className:"grid grid-cols-3 items-center gap-3",children:[(0,a.jsxs)("div",{className:"truncate",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:e.name}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:e.role})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:["Alocado: ",e.total,"%"]}),(0,a.jsxs)("div",{className:"text-xs text-green-700",children:["Dispon\xedvel: ",e.available,"%"]})]},e.id)),0===m.length&&(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Sem colaboradores cadastrados."})]})]}),r&&(0,a.jsx)(o,{projectId:r,onClose:()=>d(null)})]})}}},e=>{e.O(0,[254,204,441,964,358],()=>e(e.s=2393)),_N_E=e.O()}]);