"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[204],{2204:(t,a,e)=>{e.d(a,{C:()=>A});var o=e(8693),r=e(2354);let l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9oYW5qdnJ4eXdncmVva2tlY2tkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NjcwODMsImV4cCI6MjA3MzU0MzA4M30.XdELUZoogrJnjj3Va_kVwKEBM7GdS30EKGUZHbO3Wvo",c=!!l;c||console.warn("⚠️ Supabase n\xe3o configurado (sem chave v\xe1lida). Usando modo local.");let i=async()=>{if(!c)return!1;try{let{error:t}=await n.from("board_activities").select("id",{count:"exact",head:!0});if(t)return console.warn("⚠️ Supabase indispon\xedvel. Fallback local ativado."),!1;return!0}catch(t){return console.warn("⚠️ Supabase com erro de conex\xe3o. Usando modo local."),!1}},n=(0,r.UU)("https://ohanjvrxywgreokkeckd.supabase.co",l),s={async getAll(){if(!c)return[];let{data:t,error:a}=await n.from("board_activities").select("*").order("created_at",{ascending:!1});if(a)throw console.warn("⚠️ Erro detalhado boardActivities:",{message:a.message,details:a.details,hint:a.hint,code:a.code}),a;return t||[]},async create(t){let{data:a,error:e}=await n.from("board_activities").insert([{...t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(e)throw e;return a},async update(t,a){let{data:e,error:o}=await n.from("board_activities").update({...a,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(o)throw o;return e},async delete(t){let{error:a}=await n.from("board_activities").delete().eq("id",t);if(a)throw a}},d={async getAll(){if(!c)return[];let{data:t,error:a}=await n.from("collaborators").select("*").order("name",{ascending:!0});if(a)throw console.warn("⚠️ Erro detalhado collaborators:",a),a;return t||[]},async create(t){let{data:a,error:e}=await n.from("collaborators").insert([{id:t.id,name:t.name,email:t.email,role:t.role,avatar:t.avatar}]).select("id,name,email,role,avatar").single();if(e)throw e;return a},async update(t,a){let{data:e,error:o}=await n.from("collaborators").update({name:a.name,email:a.email,role:a.role,avatar:a.avatar}).eq("id",t).select("id,name,email,role,avatar").single();if(o)throw o;return e},async delete(t){let{error:a}=await n.from("collaborators").delete().eq("id",t);if(a)throw a}},p={async getAll(){if(!c)return[];let{data:t,error:a}=await n.from("okrs").select("*").order("created_at",{ascending:!1});if(a)throw console.warn("⚠️ Erro detalhado okrs:",a),a;return t||[]},async create(t){let{data:a,error:e}=await n.from("okrs").insert([{...t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(e)throw e;return a},async update(t,a){let{data:e,error:o}=await n.from("okrs").update({...a,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(o)throw o;return e},async delete(t){let{error:a}=await n.from("okrs").delete().eq("id",t);if(a)throw a}},u={async getAll(){if(!c)return[];let{data:t,error:a}=await n.from("rituals").select("*").order("created_at",{ascending:!1});if(a)throw console.warn("⚠️ Erro detalhado rituals:",a),a;return t||[]},async create(t){let{data:a,error:e}=await n.from("rituals").insert([{...t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(e)throw e;return a},async update(t,a){let{data:e,error:o}=await n.from("rituals").update({...a,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(o)throw o;return e},async delete(t){let{error:a}=await n.from("rituals").delete().eq("id",t);if(a)throw a}},g={async getAll(){if(!c)return[];try{let{data:a,error:e}=await n.from("projects").select("*").order("created_at",{ascending:!1});if(e){var t;if(console.warn("⚠️ Erro detalhado projects:",e),"PGRST116"===e.code||(null==(t=e.message)?void 0:t.includes("does not exist")))return console.warn("⚠️ Tabela projects n\xe3o encontrada, usando fallback"),[];throw e}return a||[]}catch(t){return console.warn("⚠️ Erro ao acessar projects:",t),[]}},async create(t){try{let{data:a,error:e}=await n.from("projects").insert([{...t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(e){console.warn("⚠️ Erro ao criar project no Supabase, salvando no localStorage");let a={...t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},e=JSON.parse(localStorage.getItem("caaqui_projects")||"[]");return e.push(a),localStorage.setItem("caaqui_projects",JSON.stringify(e)),a}return a}catch(t){throw console.error("❌ Erro ao criar project:",t),t}},async update(t,a){let{data:e,error:o}=await n.from("projects").update({...a,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(o)throw o;return e},async delete(t){let{error:a}=await n.from("projects").delete().eq("id",t);if(a)throw a}},h={async getAll(){if(!c)return[];try{let{data:a,error:e}=await n.from("project_allocations").select("\n          *,\n          projects(name, client),\n          collaborators(name, role)\n        ").order("created_at",{ascending:!1});if(e){var t;if(console.warn("⚠️ Erro detalhado project_allocations:",e),"PGRST116"===e.code||(null==(t=e.message)?void 0:t.includes("does not exist")))return console.warn("⚠️ Tabela project_allocations n\xe3o encontrada, usando fallback"),[];throw e}return a||[]}catch(t){return console.warn("⚠️ Erro ao acessar project_allocations:",t),[]}},async getByProject(t){let{data:a,error:e}=await n.from("project_allocations").select("\n        *,\n        collaborators(name, role, email)\n      ").eq("project_id",t);if(e)throw e;return a||[]},async getByCollaborator(t){let{data:a,error:e}=await n.from("project_allocations").select("\n        *,\n        projects(name, client, end_date)\n      ").eq("collaborator_id",t);if(e)throw e;return a||[]},async create(t){let{data:a,error:e}=await n.from("project_allocations").insert([{...t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(e)throw e;return a},async update(t,a){let{data:e,error:o}=await n.from("project_allocations").update({...a,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(o)throw o;return e},async delete(t){let{error:a}=await n.from("project_allocations").delete().eq("id",t);if(a)throw a}};var j=e(5434);let m={boardActivity:t=>({id:t.id,title:t.title,status:t.status,assigneeId:t.assignee_id,description:t.description,client:t.client,points:t.points,createdAt:t.created_at?new Date(t.created_at):void 0,subtasks:t.subtasks}),collaborator:t=>({id:t.id,name:t.name,email:t.email,role:t.role,avatar:t.avatar,hourlyRate:t.hourly_rate,accessLevel:t.access_level||"operations",position:t.position||t.role||"Membro"}),okr:t=>({id:t.id,title:t.title,description:t.description,progress:t.progress,quarter:"Q1 2024",activities:t.activities||[]}),ritual:t=>({id:t.id,title:t.title,content:t.content,frequency:t.frequency,nextDate:t.next_date?new Date(t.next_date):void 0,projectId:t.project_id}),project:t=>({id:t.id,name:t.name,client:t.client,type:"tech_implementation"===t.type?"tech":"growth",status:t.status,startDate:new Date(t.start_date),endDate:new Date(t.end_date),description:t.description,budget:t.budget,allocations:[],archivedAt:t.archived_at?new Date(t.archived_at):void 0,techDetails:t.tech_details,growthDetails:t.growth_details}),projectAllocation:t=>({id:t.id,projectId:t.project_id,collaboratorId:t.collaborator_id,percentage:t.percentage,role:t.role,startDate:new Date(t.start_date),endDate:new Date(t.end_date)})},b=!1,v={boardActivity:t=>{var a;return{title:t.title,status:t.status,assignee_id:t.assigneeId,description:t.description,client:t.client,points:t.points,subtasks:t.subtasks,project_id:t.projectId,due_date:null==(a=t.dueDate)?void 0:a.toISOString()}},collaborator:t=>({id:t.id,name:t.name,email:t.email,role:t.role,avatar:t.avatar}),okr:t=>({title:t.title,description:t.description,progress:t.progress,activities:t.activities}),ritual:t=>{var a;return{title:t.title,content:t.content,frequency:t.frequency,next_date:null==(a=t.nextDate)?void 0:a.toISOString(),project_id:t.projectId}},project:t=>{var a,e;return{name:t.name,client:t.client,type:"tech"===t.type?"tech_implementation":"growth_agency",status:"archived"===t.status?"cancelled":t.status,start_date:null==(a=t.startDate)?void 0:a.toISOString(),end_date:null==(e=t.endDate)?void 0:e.toISOString(),description:t.description,budget:t.budget,tech_details:t.techDetails,growth_details:t.growthDetails}},projectAllocation:t=>{var a,e;return{project_id:t.projectId,collaborator_id:t.collaboratorId,percentage:t.percentage,role:t.role,start_date:null==(a=t.startDate)?void 0:a.toISOString(),end_date:null==(e=t.endDate)?void 0:e.toISOString()}}},w=()=>Math.random().toString(36).slice(2)+Date.now().toString(36),y=(()=>{try{let t=localStorage.getItem("caaqui_collaborators");if(!t)return[];let a=JSON.parse(t);return(Array.isArray(null==a?void 0:a.data)?a.data:Array.isArray(a)?a:[])||[]}catch(t){return[]}})(),A=(0,o.vt)()((t,a)=>({boardActivities:[],collaborators:y,okrs:[],rituals:[],projects:[],projectAllocations:[],isLoading:!1,error:null,setLoading:a=>t({isLoading:a}),setError:a=>t({error:a}),setCollaborators:a=>t({collaborators:a}),loadAllData:async()=>{try{var o,r,l,c,v,w,y;if(t({isLoading:!0,error:null}),!await i().catch(()=>!1)){console.warn("⚠️ Supabase indispon\xedvel. Carregando dados do localStorage/fallback.");{let{initializeFallbackData:t}=await e.e(976).then(e.bind(e,3976));t()}}let[A,S,f,_,O,E]=await Promise.all([s.getAll().catch(t=>(console.warn("Aviso ao carregar boardActivities:",t),[])),d.getAll().catch(t=>(console.warn("Aviso ao carregar collaborators:",t),[])),p.getAll().catch(t=>(console.warn("Aviso ao carregar okrs:",t),[])),u.getAll().catch(t=>(console.warn("Aviso ao carregar rituals:",t),[])),g.getAll().catch(t=>(console.warn("Aviso ao carregar projects:",t),[])),h.getAll().catch(t=>(console.warn("Aviso ao carregar project_allocations:",t),[]))]),I=O,D=E,R=A,T=S;if(0===O.length)try{let t=localStorage.getItem("caaqui_projects");if(t)I=JSON.parse(t),console.log("\uD83D\uDCE6 Carregando projects do localStorage:",I.length);else{console.log("\uD83D\uDD04 Inicializando dados de fallback para projects...");let{initializeFallbackData:t}=await e.e(976).then(e.bind(e,3976));t();let a=localStorage.getItem("caaqui_projects");a&&(I=JSON.parse(a),console.log("✅ Dados de fallback criados para projects:",I.length))}}catch(t){console.warn("Erro ao carregar projects do localStorage:",t)}if(0===E.length)try{let t=localStorage.getItem("caaqui_project_allocations");if(t)D=JSON.parse(t),console.log("\uD83D\uDCE6 Carregando project_allocations do localStorage:",D.length);else{console.log("\uD83D\uDD04 Inicializando dados de fallback para project_allocations...");let{initializeFallbackData:t}=await e.e(976).then(e.bind(e,3976));t();let a=localStorage.getItem("caaqui_project_allocations");a&&(D=JSON.parse(a),console.log("✅ Dados de fallback criados para project_allocations:",D.length))}}catch(t){console.warn("Erro ao carregar project_allocations do localStorage:",t)}if(0===A.length)try{(R=(0,j.cY)(j.d5.BOARD_ACTIVITIES)).length>0&&console.log("\uD83D\uDCE6 Carregando board_activities do localStorage:",R.length)}catch(t){console.warn("Erro ao carregar board_activities do localStorage:",t)}if(0===S.length)try{let t=(0,j.cY)(j.d5.COLLABORATORS);t.length>0&&(T=(null==(w=t[0])?void 0:w.accessLevel)||(null==(y=t[0])?void 0:y.position)?t:t.map(m.collaborator),console.log("\uD83D\uDCE6 Carregando collaborators do localStorage:",T.length))}catch(t){console.warn("Erro ao carregar collaborators do localStorage:",t)}let C=a().collaborators||[],k=T.length>0?(null==(o=T[0])?void 0:o.accessLevel)||(null==(r=T[0])?void 0:r.position)?T:T.map(m.collaborator):[],L=(()=>{let t=new Map,a=t=>t.id||t.email||"".concat(t.name,":").concat(t.position||"");for(let e of C)t.set(a(e),e);for(let e of k)t.set(a(e),{...t.get(a(e))||{},...e});return Array.from(t.values())})();try{(0,j.gC)(j.d5.COLLABORATORS,L)}catch(t){}if(t({boardActivities:R.length>0?(null==(l=R[0])?void 0:l.id)?R.map(m.boardActivity):R:[],collaborators:L,okrs:f.map(m.okr),rituals:_.map(m.ritual),projects:I.length>0?(null==(c=I[0])?void 0:c.id)?I.map(m.project):I:[],projectAllocations:D.length>0?(null==(v=D[0])?void 0:v.id)?D.map(m.projectAllocation):D:[],isLoading:!1}),((t,a)=>{if(!b)try{let e=n.channel("caaqui-db-changes"),o=(t,e)=>{try{var o,r;console.log("[RT]",e,t.eventType,(null==(o=t.new)?void 0:o.id)||(null==(r=t.old)?void 0:r.id))}catch(t){}let l=t.eventType,c=t.new,i=t.old;if("projects"===e){if("INSERT"===l){let t=m.project(c);a(a=>({projects:[...a.projects,t]}))}else if("UPDATE"===l){let t=m.project(c);a(a=>({projects:a.projects.map(a=>a.id===t.id?{...a,...t}:a)}))}else if("DELETE"===l){let t=null==i?void 0:i.id;t&&a(a=>({projects:a.projects.filter(a=>a.id!==t)}))}}if("project_allocations"===e){if("INSERT"===l){let t=m.projectAllocation(c);a(a=>({projectAllocations:[...a.projectAllocations,t]}))}else if("UPDATE"===l){let t=m.projectAllocation(c);a(a=>({projectAllocations:a.projectAllocations.map(a=>a.id===t.id?{...a,...t}:a)}))}else if("DELETE"===l){let t=null==i?void 0:i.id;t&&a(a=>({projectAllocations:a.projectAllocations.filter(a=>a.id!==t)}))}}if("board_activities"===e){if("INSERT"===l){let t=m.boardActivity(c);a(a=>({boardActivities:[...a.boardActivities,t]}))}else if("UPDATE"===l){let t=m.boardActivity(c);a(a=>({boardActivities:a.boardActivities.map(a=>a.id===t.id?{...a,...t}:a)}))}else if("DELETE"===l){let t=null==i?void 0:i.id;t&&a(a=>({boardActivities:a.boardActivities.filter(a=>a.id!==t)}))}}if("rituals"===e){if("INSERT"===l){let t=m.ritual(c);a(a=>({rituals:[...a.rituals,t]}))}else if("UPDATE"===l){let t=m.ritual(c);a(a=>({rituals:a.rituals.map(a=>a.id===t.id?{...a,...t}:a)}))}else if("DELETE"===l){let t=null==i?void 0:i.id;t&&a(a=>({rituals:a.rituals.filter(a=>a.id!==t)}))}}if("collaborators"===e){if("INSERT"===l){let t=m.collaborator(c);a(a=>({collaborators:[...a.collaborators,t]}))}else if("UPDATE"===l){let t=m.collaborator(c);a(a=>({collaborators:a.collaborators.map(a=>a.id===t.id?{...a,...t}:a)}))}else if("DELETE"===l){let t=null==i?void 0:i.id;t&&a(a=>({collaborators:a.collaborators.filter(a=>a.id!==t)}))}}};e.on("postgres_changes",{event:"*",schema:"public",table:"projects"},t=>o(t,"projects")).on("postgres_changes",{event:"*",schema:"public",table:"project_allocations"},t=>o(t,"project_allocations")).on("postgres_changes",{event:"*",schema:"public",table:"board_activities"},t=>o(t,"board_activities")).on("postgres_changes",{event:"*",schema:"public",table:"rituals"},t=>o(t,"rituals")).on("postgres_changes",{event:"*",schema:"public",table:"collaborators"},t=>o(t,"collaborators")).subscribe(async e=>{if("SUBSCRIBED"===e){console.log("\uD83D\uDD14 Realtime conectado");try{let[e,o]=await Promise.all([d.getAll().catch(()=>[]),h.getAll().catch(()=>[])]);a(t=>({collaborators:Array.isArray(e)&&e.length>0?e.map(m.collaborator):t.collaborators,projectAllocations:Array.isArray(o)&&o.length>0?o.map(m.projectAllocation):t.projectAllocations}));let r=0,l=async()=>{var e,o;r++;let c=t(),i=0===((null==(e=c.collaborators)?void 0:e.length)||0),n=0===((null==(o=c.projectAllocations)?void 0:o.length)||0);if(i||n){try{let[t,e]=await Promise.all([i?d.getAll().catch(()=>[]):Promise.resolve([]),n?h.getAll().catch(()=>[]):Promise.resolve([])]);if((null==t?void 0:t.length)>0||(null==e?void 0:e.length)>0)return void a(a=>({collaborators:(null==t?void 0:t.length)>0?t.map(m.collaborator):a.collaborators,projectAllocations:(null==e?void 0:e.length)>0?e.map(m.projectAllocation):a.projectAllocations}))}catch(t){}r<6&&setTimeout(l,5e3)}};setTimeout(l,5e3)}catch(t){console.warn("⚠️ Falha ao hidratar ap\xf3s SUBSCRIBED:",t)}}}),b=!0}catch(t){console.warn("⚠️ Falha ao iniciar Realtime:",t)}})(a,t),0===L.length)try{let a=localStorage.getItem("caaqui_collaborators");if(a){let e=JSON.parse(a),o=Array.isArray(null==e?void 0:e.data)?e.data:Array.isArray(e)?e:[];o.length>0&&(t({collaborators:o}),(0,j.gC)(j.d5.COLLABORATORS,o))}}catch(t){}}catch(a){console.error("Erro geral ao carregar dados:",a),t({error:"Erro ao conectar com Supabase: ".concat(a.message),isLoading:!1})}},addBoardActivity:async(a,e)=>{try{var o;let r={id:w(),title:a,status:null!=(o=null==e?void 0:e.status)?o:"todo",assignee_id:null==e?void 0:e.assigneeId,description:null==e?void 0:e.description,client:null==e?void 0:e.client,project_id:null==e?void 0:e.projectId,points:null==e?void 0:e.points,subtasks:null==e?void 0:e.subtasks,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};try{let a=await s.create(r),e=m.boardActivity(a);t(t=>({boardActivities:[...t.boardActivities,e]}))}catch(o){console.warn("⚠️ Erro ao criar atividade no Supabase, usando localStorage");let a=(0,j.cY)(j.d5.BOARD_ACTIVITIES);a.push(r),(0,j.gC)(j.d5.BOARD_ACTIVITIES,a);let e=m.boardActivity(r);t(t=>({boardActivities:[...t.boardActivities,e]}))}}catch(a){console.error("Erro ao adicionar atividade:",a),t({error:"Erro ao adicionar atividade"})}},updateBoardActivity:async(a,e)=>{try{try{let o=v.boardActivity(e),r=await s.update(a,o),l=m.boardActivity(r);t(t=>({boardActivities:t.boardActivities.map(t=>t.id===a?{...t,...l}:t)}))}catch(l){console.warn("⚠️ Erro ao atualizar atividade no Supabase, usando localStorage");let o={...e,id:a,updatedAt:new Date};t(t=>({boardActivities:t.boardActivities.map(t=>t.id===a?{...t,...o}:t)}));let r=(0,j.cY)(j.d5.BOARD_ACTIVITIES).map(t=>t.id===a?{...t,...v.boardActivity(o)}:t);(0,j.gC)(j.d5.BOARD_ACTIVITIES,r)}}catch(a){console.error("Erro ao atualizar atividade:",a),t({error:"Erro ao atualizar atividade"})}},deleteBoardActivity:async a=>{try{try{await s.delete(a)}catch(e){console.warn("⚠️ Erro ao deletar atividade no Supabase, usando localStorage");let t=(0,j.cY)(j.d5.BOARD_ACTIVITIES).filter(t=>t.id!==a);(0,j.gC)(j.d5.BOARD_ACTIVITIES,t)}t(t=>({boardActivities:t.boardActivities.filter(t=>t.id!==a)}))}catch(a){console.error("Erro ao deletar atividade:",a),t({error:"Erro ao deletar atividade"})}},addCollaborator:async e=>{try{let o={id:w(),...e};t(t=>({collaborators:[...t.collaborators,o]})),console.log("\uD83D\uDC65 [addCollaborator] Otimista ->",o);try{let t=(0,j.cY)(j.d5.COLLABORATORS);t.push(o),(0,j.gC)(j.d5.COLLABORATORS,t)}catch(t){}try{let e=v.collaborator(o),r=await d.create(e),l=m.collaborator(r);t(t=>({collaborators:t.collaborators.map(t=>t.id===o.id?{...t,...l}:t)})),console.log("\uD83D\uDC65 [addCollaborator] Persistido no Supabase, convertido ->",l);try{let t=a().collaborators;(0,j.gC)(j.d5.COLLABORATORS,t)}catch(t){}}catch(a){console.warn("⚠️ Erro ao criar colaborador no Supabase, usando localStorage");let t=(0,j.cY)(j.d5.COLLABORATORS);t.push(o),(0,j.gC)(j.d5.COLLABORATORS,t),console.log("\uD83D\uDCBE [addCollaborator] Salvo no localStorage. Total local ->",t.length)}}catch(a){console.error("Erro ao adicionar colaborador:",a),t({error:"Erro ao adicionar colaborador"})}},updateCollaborator:async(e,o)=>{try{try{let r=v.collaborator(o),l=await d.update(e,r),c=m.collaborator(l);t(t=>({collaborators:t.collaborators.map(t=>t.id===e?{...t,...c}:t)}));try{let t=a().collaborators;(0,j.gC)(j.d5.COLLABORATORS,t)}catch(t){}}catch(c){console.warn("⚠️ Erro ao atualizar colaborador no Supabase, usando localStorage");let a={...o,id:e};t(t=>({collaborators:t.collaborators.map(t=>t.id===e?{...t,...a}:t)}));let r=(0,j.cY)(j.d5.COLLABORATORS),l=r.length>0?r.map(t=>t.id===e?{...t,...a}:t):[];l.length>0&&(0,j.gC)(j.d5.COLLABORATORS,l)}}catch(a){console.error("Erro ao atualizar colaborador:",a),t({error:"Erro ao atualizar colaborador"})}},deleteCollaborator:async e=>{try{try{await d.delete(e)}catch(o){console.warn("⚠️ Erro ao deletar colaborador no Supabase, usando localStorage");let t=(0,j.cY)(j.d5.COLLABORATORS),a=t.filter(t=>t.id!==e);t.length!==a.length&&(0,j.gC)(j.d5.COLLABORATORS,a)}t(t=>({collaborators:t.collaborators.filter(t=>t.id!==e)}));try{let t=a().collaborators;(0,j.gC)(j.d5.COLLABORATORS,t)}catch(t){}}catch(a){console.error("Erro ao deletar colaborador:",a),t({error:"Erro ao deletar colaborador"})}},addOKR:async a=>{try{let e={id:w(),...a},o=await p.create(e),r=m.okr(o);t(t=>({okrs:[...t.okrs,r]}))}catch(a){console.error("Erro ao adicionar OKR:",a),t({error:"Erro ao adicionar OKR"})}},updateOKR:async(a,e)=>{try{let o=v.okr(e),r=await p.update(a,o),l=m.okr(r);t(t=>({okrs:t.okrs.map(t=>t.id===a?{...t,...l}:t)}))}catch(a){console.error("Erro ao atualizar OKR:",a),t({error:"Erro ao atualizar OKR"})}},deleteOKR:async a=>{try{await p.delete(a),t(t=>({okrs:t.okrs.filter(t=>t.id!==a)}))}catch(a){console.error("Erro ao deletar OKR:",a),t({error:"Erro ao deletar OKR"})}},addOKRActivity:async(e,o,r)=>{try{let t=a().okrs.find(t=>t.id===e);if(!t)return;let l={id:w(),title:o,assigneeId:r},c=[...t.activities,l];await a().updateOKR(e,{activities:c})}catch(a){console.error("Erro ao adicionar atividade OKR:",a),t({error:"Erro ao adicionar atividade OKR"})}},updateOKRActivity:async(e,o,r)=>{try{let t=a().okrs.find(t=>t.id===e);if(!t)return;let l=t.activities.map(t=>t.id===o?{...t,...r}:t);await a().updateOKR(e,{activities:l})}catch(a){console.error("Erro ao atualizar atividade OKR:",a),t({error:"Erro ao atualizar atividade OKR"})}},deleteOKRActivity:async(e,o)=>{try{let t=a().okrs.find(t=>t.id===e);if(!t)return;let r=t.activities.filter(t=>t.id!==o);await a().updateOKR(e,{activities:r})}catch(a){console.error("Erro ao deletar atividade OKR:",a),t({error:"Erro ao deletar atividade OKR"})}},addRitual:async a=>{try{let e={id:w(),title:a},o=await u.create(e),r=m.ritual(o);t(t=>({rituals:[...t.rituals,r]}))}catch(a){console.error("Erro ao adicionar ritual:",a),t({error:"Erro ao adicionar ritual"})}},updateRitual:async(a,e)=>{try{let o=v.ritual(e),r=await u.update(a,o),l=m.ritual(r);t(t=>({rituals:t.rituals.map(t=>t.id===a?{...t,...l}:t)}))}catch(a){console.error("Erro ao atualizar ritual:",a),t({error:"Erro ao atualizar ritual"})}},deleteRitual:async a=>{try{await u.delete(a),t(t=>({rituals:t.rituals.filter(t=>t.id!==a)}))}catch(a){console.error("Erro ao deletar ritual:",a),t({error:"Erro ao deletar ritual"})}},addProject:async a=>{try{let e={id:w(),...a,createdAt:new Date,updatedAt:new Date};try{let a=v.project(e),o=await g.create(a),r=m.project(o);t(t=>({projects:[...t.projects,r]}))}catch(l){console.warn("⚠️ Erro ao criar projeto no Supabase, usando localStorage");let a=JSON.parse(localStorage.getItem("caaqui_projects")||"[]"),o=v.project(e);a.push(o),localStorage.setItem("caaqui_projects",JSON.stringify(a));let r={...e,allocations:[]};t(t=>({projects:[...t.projects,r]}))}}catch(a){console.error("Erro ao adicionar projeto:",a),t({error:"Erro ao adicionar projeto"})}},updateProject:async(a,e)=>{try{try{let o=v.project(e),r=await g.update(a,o),l=m.project(r);t(t=>({projects:t.projects.map(t=>t.id===a?{...t,...l}:t)}))}catch(l){console.warn("⚠️ Erro ao atualizar no Supabase, usando localStorage");let o={...e,id:a,updatedAt:new Date};t(t=>({projects:t.projects.map(t=>t.id===a?{...t,...o}:t)}));let r=JSON.parse(localStorage.getItem("caaqui_projects")||"[]").map(t=>t.id===a?{...t,...v.project(o)}:t);localStorage.setItem("caaqui_projects",JSON.stringify(r))}}catch(a){console.error("Erro ao atualizar projeto:",a),t({error:"Erro ao atualizar projeto"})}},deleteProject:async e=>{try{try{for(let t of(await h.getByProject(e)).map(t=>t.id))try{await h.delete(t)}catch(t){}}catch(a){let t=JSON.parse(localStorage.getItem("caaqui_project_allocations")||"[]").filter(t=>(t.project_id||t.projectId)!==e);localStorage.setItem("caaqui_project_allocations",JSON.stringify(t))}try{for(let t of a().boardActivities.filter(t=>t.projectId===e))try{await s.delete(t.id)}catch(t){}t(t=>({boardActivities:t.boardActivities.filter(t=>t.projectId!==e)}))}catch(t){}try{await g.delete(e)}catch(a){console.warn("⚠️ Erro ao deletar no Supabase, usando localStorage");let t=JSON.parse(localStorage.getItem("caaqui_projects")||"[]").filter(t=>t.id!==e);localStorage.setItem("caaqui_projects",JSON.stringify(t))}t(t=>({projects:t.projects.filter(t=>t.id!==e),projectAllocations:t.projectAllocations.filter(t=>t.projectId!==e)}))}catch(a){console.error("Erro ao deletar projeto:",a),t({error:"Erro ao deletar projeto"})}},addProjectAllocation:async a=>{try{let e={id:w(),...a};try{let a=v.projectAllocation(e),o=await h.create(a),r=m.projectAllocation(o);t(t=>({projectAllocations:[...t.projectAllocations,r]}))}catch(r){console.warn("⚠️ Erro ao criar aloca\xe7\xe3o no Supabase, usando localStorage");let a=JSON.parse(localStorage.getItem("caaqui_project_allocations")||"[]"),o=v.projectAllocation(e);a.push(o),localStorage.setItem("caaqui_project_allocations",JSON.stringify(a)),t(t=>({projectAllocations:[...t.projectAllocations,e]}))}}catch(a){console.error("Erro ao adicionar aloca\xe7\xe3o:",a),t({error:"Erro ao adicionar aloca\xe7\xe3o"})}},updateProjectAllocation:async(a,e)=>{try{try{let o=v.projectAllocation(e),r=await h.update(a,o),l=m.projectAllocation(r);t(t=>({projectAllocations:t.projectAllocations.map(t=>t.id===a?{...t,...l}:t)}))}catch(l){console.warn("⚠️ Erro ao atualizar aloca\xe7\xe3o no Supabase, usando localStorage");let o={...e,id:a,updatedAt:new Date};t(t=>({projectAllocations:t.projectAllocations.map(t=>t.id===a?{...t,...o}:t)}));let r=JSON.parse(localStorage.getItem("caaqui_project_allocations")||"[]").map(t=>t.id===a?{...t,...v.projectAllocation(o)}:t);localStorage.setItem("caaqui_project_allocations",JSON.stringify(r))}}catch(a){console.error("Erro ao atualizar aloca\xe7\xe3o:",a),t({error:"Erro ao atualizar aloca\xe7\xe3o"})}},deleteProjectAllocation:async a=>{try{try{await h.delete(a)}catch(e){console.warn("⚠️ Erro ao deletar aloca\xe7\xe3o no Supabase, usando localStorage");let t=JSON.parse(localStorage.getItem("caaqui_project_allocations")||"[]").filter(t=>t.id!==a);localStorage.setItem("caaqui_project_allocations",JSON.stringify(t))}t(t=>({projectAllocations:t.projectAllocations.filter(t=>t.id!==a)}))}catch(a){console.error("Erro ao deletar aloca\xe7\xe3o:",a),t({error:"Erro ao deletar aloca\xe7\xe3o"})}},getTeamAvailability:()=>{let t=a(),e=[];return console.log("\uD83D\uDD0D Debug disponibilidade detalhado:"),console.log("- Total collaborators:",t.collaborators.length),console.log("- Total projectAllocations:",t.projectAllocations.length),console.log("- Total projects:",t.projects.length),t.collaborators.forEach(a=>{console.log("\n\uD83D\uDC64 Analisando ".concat(a.name," (").concat(a.id,"):"));let o=new Date,r=t.projectAllocations.filter(t=>t.collaboratorId===a.id);console.log("- Total aloca\xe7\xf5es para ".concat(a.name,":"),r.length),r.forEach(a=>{let e=t.projects.find(t=>t.id===a.projectId),r=new Date(a.endDate)>o;console.log("  • Projeto: ".concat((null==e?void 0:e.name)||"N\xc3O ENCONTRADO"," (").concat(a.projectId,")")),console.log("    - Percentual: ".concat(a.percentage,"%")),console.log("    - Ativo: ".concat(r)),console.log("    - Data fim: ".concat(a.endDate))});let l=r.filter(a=>{let e=t.projects.find(t=>t.id===a.projectId),r=e&&"archived"!==e.status&&"cancelled"!==e.status,l=new Date(a.endDate)>o;return!!e&&r&&l}),c=l.reduce((t,a)=>t+a.percentage,0),i=a.maxAllocation||100,n=l.map(a=>{let e=t.projects.find(t=>t.id===a.projectId);return{projectId:a.projectId,projectName:(null==e?void 0:e.name)||"Projeto n\xe3o encontrado",allocation:a.percentage,endDate:a.endDate}});e.push({collaboratorId:a.id,name:a.name,role:a.role,totalAllocation:Math.min(c,i),availableAllocation:Math.max(0,i-c),projects:n})}),e},getProjectMetrics:()=>{let{projects:t,projectAllocations:e,collaborators:o}=a();return t.map(t=>{let a=e.filter(a=>a.projectId===t.id),r=a.reduce((t,a)=>t+a.percentage,0),l=a.reduce((t,a)=>{let e=o.find(t=>t.id===a.collaboratorId);if(!(null==e?void 0:e.hourlyRate))return t;let r=new Date(a.startDate),l=Math.ceil((new Date(a.endDate).getTime()-r.getTime())/6048e5);return t+a.percentage/100*40*l*e.hourlyRate},0),c=new Date(t.startDate),i=new Date(t.endDate),n=new Date,s=Math.ceil((i.getTime()-c.getTime())/864e5),d=Math.ceil((n.getTime()-c.getTime())/864e5),p=Math.ceil((i.getTime()-n.getTime())/864e5),u=Math.min(100,Math.max(0,d/s*100));return{id:t.id,name:t.name,status:t.status,progressPct:u,daysRemaining:p,isOnTime:p>=0&&u<=100,totalAllocation:r,realCost:l,budgetVariance:t.budget?(l-t.budget)/t.budget*100:0}})},archiveProject:async e=>{try{let t=new Date;await a().updateProject(e,{status:"archived",archivedAt:t})}catch(a){console.error("Erro ao arquivar projeto:",a),t({error:"Erro ao arquivar projeto"})}},restoreProject:async e=>{try{await a().updateProject(e,{status:"active",archivedAt:void 0})}catch(a){console.error("Erro ao restaurar projeto:",a),t({error:"Erro ao restaurar projeto"})}},permanentlyDeleteProject:async e=>{try{await a().deleteProject(e)}catch(a){console.error("Erro ao excluir projeto permanentemente:",a),t({error:"Erro ao excluir projeto permanentemente"})}},cleanupArchivedProjects:async()=>{try{let{projects:t}=a(),e=new Date;e.setDate(e.getDate()-30);let o=t.filter(t=>"archived"===t.status&&t.archivedAt&&t.archivedAt<e);for(let t of o)await a().permanentlyDeleteProject(t.id);console.log("Limpeza autom\xe1tica: ".concat(o.length," projetos removidos"))}catch(t){console.error("Erro na limpeza de projetos arquivados:",t)}},duplicateProject:async(e,o)=>{try{let{projects:t,projectAllocations:r}=a(),l=t.find(t=>t.id===e);if(!l)throw Error("Projeto n\xe3o encontrado");let c={name:o||"".concat(l.name," (C\xf3pia)"),client:l.client,type:l.type,status:"planning",startDate:new Date,endDate:new Date(Date.now()+2592e6),description:l.description,budget:l.budget,techDetails:l.techDetails,growthDetails:l.growthDetails};await a().addProject(c);let{projects:i}=a(),n=i.find(t=>t.name===c.name);if(n)for(let t of r.filter(t=>t.projectId===e)){let e={projectId:n.id,collaboratorId:t.collaboratorId,percentage:t.percentage,role:t.role,startDate:c.startDate,endDate:c.endDate};await a().addProjectAllocation(e)}console.log("Projeto duplicado com sucesso")}catch(a){console.error("Erro ao duplicar projeto:",a),t({error:"Erro ao duplicar projeto"})}},createProjectFromTemplate:async(o,r,l)=>{try{let{getTemplateById:t,createProjectFromTemplate:c}=await e.e(597).then(e.bind(e,8597)),i=t(o);if(!i)throw Error("Template n\xe3o encontrado");let{project:n,tasks:s}=c(i,r,l);await a().addProject(n);let{projects:d}=a(),p=d.find(t=>t.name===r);if(p)for(let t of s)await a().addBoardActivity(t.title,{...t,projectId:p.id});console.log("Projeto criado a partir do template com sucesso")}catch(a){console.error("Erro ao criar projeto a partir do template:",a),t({error:"Erro ao criar projeto a partir do template"})}},duplicateBoardActivity:async e=>{try{let{boardActivities:t}=a(),o=t.find(t=>t.id===e);if(!o)throw Error("Atividade n\xe3o encontrada");let r={title:"".concat(o.title," (C\xf3pia)"),status:"backlog",assigneeId:o.assigneeId,description:o.description,client:o.client,projectId:o.projectId,subtasks:o.subtasks?[...o.subtasks]:void 0};await a().addBoardActivity(r.title,r),console.log("Card duplicado com sucesso")}catch(a){console.error("Erro ao duplicar card:",a),t({error:"Erro ao duplicar card"})}}}))},5434:(t,a,e)=>{e.d(a,{Qx:()=>i,Rz:()=>c,cY:()=>l,d5:()=>o,gC:()=>r});let o={BOARD_ACTIVITIES:"caaqui_board_activities",PROJECTS:"caaqui_projects",PROJECT_ALLOCATIONS:"caaqui_project_allocations",COLLABORATORS:"caaqui_collaborators",OKRS:"caaqui_okrs",RITUALS:"caaqui_rituals",LAST_SYNC:"caaqui_last_sync"};function r(t,a,e){try{let r={timestamp:new Date().toISOString(),data:a,userId:e};localStorage.setItem(t,JSON.stringify(r)),localStorage.setItem(o.LAST_SYNC,new Date().toISOString());let l=Array.isArray(a)?a.length:"object"==typeof a&&null!==a?Object.keys(a).length:1;console.log("\uD83D\uDCBE Dados salvos em ".concat(t,":"),l,"itens")}catch(t){console.error("Erro ao salvar no localStorage:",t)}}function l(t){try{let a=localStorage.getItem(t);if(!a)return[];let e=JSON.parse(a),o=Array.isArray(e.data)?e.data:[];return console.log("\uD83D\uDCE6 Dados carregados de ".concat(t,":"),o.length,"itens"),o}catch(t){return console.error("Erro ao carregar do localStorage:",t),[]}}function c(){try{let t={};Object.values(o).forEach(a=>{let e=l(a);e.length>0&&(t[a]=e)});let a={timestamp:new Date().toISOString(),version:"1.0",data:t},e=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),r=URL.createObjectURL(e),c=document.createElement("a");return c.href=r,c.download="caaqui-backup-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(r),console.log("\uD83D\uDCE4 Dados exportados com sucesso"),t}catch(t){return console.error("Erro ao exportar dados:",t),{}}}function i(t){try{return Object.entries(t).forEach(t=>{let[a,e]=t;r(a,e)}),console.log("\uD83D\uDCE5 Dados importados com sucesso"),!0}catch(t){return console.error("Erro ao importar dados:",t),!1}}}}]);